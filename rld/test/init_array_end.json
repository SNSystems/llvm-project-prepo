// We have a strongly-bound reference to __init_array_end but no definition
// for the symbol. This is generated by the linker as an alias for the end
// of the init_array section.

// RUN: rm -rf %t && mkdir -p %t
// RUN: pstore-import %t/repo.repo %s
// RUN: repo-create-ticket --repo %t/repo.repo -o %t/t.o ed6d29216e181fca7e6f77a20c0075ab
// RUN: rld --repo %t/repo.repo -o %t/rld.out %t/t.o
// RUN: llvm-readelf --symbols %t/rld.out | FileCheck %s

// CHECK: 0: 0000000000000000  0 NOTYPE LOCAL  DEFAULT UND
// CHECK: 1: 0000000000401020 18 FUNC   LOCAL  DEFAULT   1 run_global_ctors
// CHECK: 2: 0000000000401000  6 FUNC   WEAK   DEFAULT   1 _ZN1tC2Ev
// CHECK: 3: 0000000000401010  9 FUNC   GLOBAL DEFAULT   1 _start
// CHECK: 4: 0000000000402000  8 OBJECT GLOBAL DEFAULT   3 llvm.global_ctors
// CHECK: 5: 0000000000402008  1 OBJECT GLOBAL DEFAULT   2 t1
// CHECK: 6: 0000000000402008  8 OBJECT GLOBAL DEFAULT   3 __init_array_end

{
  "version":1,
  "id":"d2308a42-a7ac-4fae-a8ba-4a0983d48d90",
  "transactions":[
    {
      "names":[
        "x86_64-pc-linux-gnu-repo", // #0
        "_ZN1tC2Ev",                // #1 t::t()
        "__init_array_end",         // #2
        "t1",                       // #3
        "llvm.global_ctors",        // #4 magic global ctor name
        "_start",                   // #5 entry point
        "run_global_ctors"   // #6
      ],
      "fragments":{
        // "_start"
        "be71d111190108d16c78caca1f3996ec":{
          "text":{
            "align":16,
            "data":"SIsEJQAAAADD",
            "xfixups":[
              {"name":2,"type":11,"offset":4,"addend":0} //"__init_array_end"
            ]
          }
        },
        // "llvm.global_ctors"
        "731dc261c79fc95e5e4b68b5afb9a070":{
          "read_only":{
            "align":8,
            "data":"AAAAAAAAAAA=",
            "xfixups":[
              {"name":6,"type":1,"offset":0,"addend":0} //"run_global_ctors"
            ]
          }
        },
        // "_ZN1tC2Ev"
        "459781ce28263d218adfeb3302b1609f":{
          "text":{
            "align":16,
            "data":"SIl8JPjD"
          }
        },
        // "run_global_ctors"
        "289386c7d0fe6ee6b8be378888c59ed7":{
          "text":{
            "align":16,
            "data":"UEi/AAAAAAAAAADoAAAAAFjD",
            "xfixups":[
              {"name":3,"type":1,"offset":3,"addend":0}, //"t1"
              {"name":1,"type":4,"is_weak":true,"offset":12,"addend":-4} //"_ZN1tC2Ev"
            ]
          }
        },
        // "t1"
        "d5195616d6aea4b0fea6f392fb4c6766":{
          "bss":{
            "size":1
          }
        }
      },
      "compilations":{
        "ed6d29216e181fca7e6f77a20c0075ab":{
          "triple":0, //"x86_64-pc-linux-gnu-repo"
          "definitions":[
            {"digest":"459781ce28263d218adfeb3302b1609f","name":1,"linkage":"link_once_odr"}, //"_ZN1tC2Ev"
            {"digest":"be71d111190108d16c78caca1f3996ec","name":5,"linkage":"external"}, //"_start"
            {"digest":"289386c7d0fe6ee6b8be378888c59ed7","name":6,"linkage":"internal"}, //"run_global_ctors"
            {"digest":"d5195616d6aea4b0fea6f392fb4c6766","name":3,"linkage":"external"}, //"t1"
            {"digest":"731dc261c79fc95e5e4b68b5afb9a070","name":4,"linkage":"append"} //"llvm.global_ctors"
          ]
        }
      }
    }
  ]
}
