// RUN: rm -rf %t && mkdir -p %t
// RUN: pstore-import %t/db.db %s
// RUN: repo-create-ticket --repo %t/db.db -o %t/t0.o 008fecf0ccab0c7a71a5672579eaca1e
// RUN: repo-create-ticket --repo %t/db.db -o %t/t1.o 6c951506a8c75884774cd5d4507740cd
// RUN: rld --repo=%t/db.db -o %t/rld.out %t/t0.o %t/t1.o
// RUN: llvm-readelf --program-headers %t/rld.out | FileCheck %s

// CHECK: Elf file type is EXEC (Executable file)
// CHECK: Entry point 0x401000
// CHECK: There are 4 program headers, starting at offset 64
//
// CHECK: Program Headers:
// CHECK-NEXT:   Type      Offset   VirtAddr           PhysAddr           FileSiz  MemSiz   Flg Align
// CHECK-NEXT:   PHDR      0x000000 0x0000000000400000 0x0000000000400000 0x000120 0x000120 R 0x1
// CHECK-NEXT:   LOAD      0x000000 0x0000000000400000 0x0000000000400000 0x000158 0x000158 R 0x1000
// CHECK-NEXT:   LOAD      0x001000 0x0000000000401000 0x0000000000401000 0x0000c6 0x0000c6 R E 0x1000
// CHECK-NEXT:   GNU_STACK 0x000000 0x0000000000000000 0x0000000000000000 0x000000 0x000000 RW  0x0
//
// CHECK:      Section to Segment mapping:
// CHECK-NEXT:  Segment Sections...
// CHECK-NEXT:   00
// CHECK-NEXT:   01     .rodata.str1.1 .rodata
// CHECK-NEXT:   02     .text
// CHECK-NEXT:   03
// CHECK-NEXT:   None   .shstrtab .strtab .symtab


{
    "version":1,
    "id":"7bae6eae-ce1d-4fe9-a45d-981f0e5758d6",
    "transactions":[
        {
            // generation 1
            "names":[
                "x86_64-pc-linux-gnu-repo", // 0
                "main", // 1
                "printf", // 2
                ".str.1", // 3
                ".str", // 4
                "ultimate_answer", // 5
                "foo" // 6
            ],
            "fragments":{
                "f9bb578a7abfc702dc7fa54f7b4af05f":{
                    "text":{
                        "align":16,
                        "data":"VUiJ5bgrAAAAXcM="
                    }
                },
                "1ce0ffb3c3f3440bbdcfd26e4d66dc24":{
                    "mergeable_1_byte_c_string":{
                        "data":"JWQKAA=="
                    }
                },
                "96ded9543181a34d8d1427698348ad1d":{
                    "text":{
                        "align":16,
                        "data":"VUiJ5UiD7BBIvwAAAAAAAAAAsADoAAAAAL8GAAAAiUX86AAAAABIvwAAAAAAAAAAicawAOgAAAAAMcmJRfiJyEiDxBBdww=="
                    }
                },
                "d86ded26b9f6811fe38f8a5812db1dc9":{
                    "mergeable_1_byte_c_string":{
                        "data":"SGVsbG8sIHdvcmxkLgoA"
                    }
                },
                "024badfa2effcb85e10be56851688097":{
                    "text":{
                        "align":16,
                        "data":"VUiJ5Yl9+ItF+IPA/4nBg+gDSIlN8A+HPgAAAEiLRfBIiwzFAAAAAP/hx0X8BQAAAOkrAAAAx0X8BgAAAOkfAAAAx0X8BwAAAOkTAAAAx0X8CAAAAOkHAAAAx0X8CQAAAItF/F3D",
                        "ifixups":[
                            {"section":"read_only","type":11,"offset":36,"addend":0}
                        ]
                    },
                    "read_only":{
                        "align":8,
                        "data":"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=",
                        "ifixups":[
                            {"section":"text","type":1,"offset":0,"addend":42},
                            {"section":"text","type":1,"offset":8,"addend":54},
                            {"section":"text","type":1,"offset":16,"addend":66},
                            {"section":"text","type":1,"offset":24,"addend":78}
                        ]
                    }
                }
            },
            "compilations":{
                "008fecf0ccab0c7a71a5672579eaca1e":{
                    "triple":0, //"x86_64-pc-linux-gnu-repo"
                    "definitions":[
                        {"digest":"f9bb578a7abfc702dc7fa54f7b4af05f","name":5,"linkage":"external"}, //"ultimate_answer"
                        {"digest":"96ded9543181a34d8d1427698348ad1d","name":1,"linkage":"external"}, //"main"
                        {"digest":"d86ded26b9f6811fe38f8a5812db1dc9","name":4,"linkage":"internal_no_symbol"}, //".str"
                        {"digest":"1ce0ffb3c3f3440bbdcfd26e4d66dc24","name":3,"linkage":"internal_no_symbol"} //".str.1"
                    ]
                },
                "6c951506a8c75884774cd5d4507740cd":{
                    "triple":0, //"x86_64-pc-linux-gnu-repo"
                    "definitions":[
                        {"digest":"024badfa2effcb85e10be56851688097","name":6,"linkage":"external"} //"foo"
                    ]
                }
            }
        }
    ]
}
